# 動作確認手順

## 1. 基本機能の確認

### 1.1 アプリケーション起動確認

#### バックエンドの確認

```bash
# ヘルスチェック
curl http://localhost:8000/health
```

期待されるレスポンス：
```json
{
  "status": "healthy",
  "timestamp": "2024-01-20T10:00:00",
  "version": "1.0.0"
}
```

#### フロントエンドの確認

ブラウザで `http://localhost:5173` にアクセス

確認項目：
- [ ] ログイン画面が表示される
- [ ] ロゴとタイトルが表示される
- [ ] フォームフィールドが操作可能

### 1.2 ユーザー登録とログイン

#### 新規ユーザー登録

1. 「新規登録」ボタンをクリック
2. 以下の情報を入力：
   ```
   メールアドレス: demo@example.com
   パスワード: Demo123!@#
   パスワード確認: Demo123!@#
   氏名: デモ ユーザー
   ```
3. 「登録」ボタンをクリック

期待される動作：
- 登録成功メッセージが表示
- 自動的にログイン画面へ遷移

#### ログイン

1. 登録したアカウント情報を入力：
   ```
   メールアドレス: demo@example.com
   パスワード: Demo123!@#
   ```
2. 「ログイン」ボタンをクリック

期待される動作：
- ダッシュボードへ遷移
- ユーザー名が右上に表示

## 2. タスク管理機能のテスト

### 2.1 手動タスク作成

1. ダッシュボードで「新規タスク」ボタンをクリック
2. 以下の情報を入力：

```yaml
タイトル: テストタスク - OpenAI API動作確認
説明: |
  このタスクは動作確認用です。
  以下の項目を確認します：
  - タスクの作成
  - ステータス変更
  - AI分析機能
優先度: 高
期限: 2024-02-01
```

3. 「作成」ボタンをクリック

確認項目：
- [ ] タスクがリストに表示される
- [ ] 優先度バッジが「高」で赤色
- [ ] 作成者が「ユーザー」と表示

### 2.2 タスクステータスの変更

1. 作成したタスクカードのステータスドロップダウンをクリック
2. 「TODO」→「進行中」に変更

確認項目：
- [ ] ステータスアイコンが変わる（時計アイコン）
- [ ] 色がプライマリカラーに変更

### 2.3 タスク詳細の確認

1. タスクカードをクリック
2. 詳細ページへ遷移

確認項目：
- [ ] タイトルと説明が表示される
- [ ] 「概要」「メール履歴」「AI調査」タブが表示
- [ ] サイドバーに「タスク情報」「メモ」が表示

## 3. OpenAI API連携テスト

### 3.1 AI分析機能の確認

#### テスト用タスクの作成

1. 新規タスクを作成：
```yaml
タイトル: プロジェクト提案書の作成
説明: |
  Q2の新規プロジェクトについて提案書を作成する。
  以下を含める：
  - プロジェクト概要
  - 予算見積もり（500万円程度）
  - スケジュール（3ヶ月）
  - 必要リソース
優先度: 高
期限: 2024-02-15
```

#### AI分析の実行

1. タスク詳細画面を開く
2. 「AI調査」タブをクリック
3. チャット入力欄に以下を入力：
   ```
   このタスクを効率的に進めるための手順を教えてください
   ```
4. 送信ボタンをクリック

期待されるレスポンス例：
```
プロジェクト提案書を効率的に作成するための手順：

1. 情報収集フェーズ（2日）
   - 過去の提案書をレビュー
   - ステークホルダーへのヒアリング
   - 市場調査

2. 構成作成フェーズ（1日）
   - アウトライン作成
   - 各セクションの要点整理

3. 執筆フェーズ（3日）
   - 各セクションの執筆
   - 図表の作成

4. レビューフェーズ（2日）
   - 内部レビュー
   - 修正対応
```

### 3.2 API使用量の確認

```bash
# ログファイルでAPI呼び出しを確認
tail -f packages/backend/pmo_agent.log | grep -i openai
```

確認項目：
- [ ] API呼び出しが記録されている
- [ ] トークン使用量が表示される
- [ ] エラーが発生していない

## 4. Outlook連携テスト

### 4.1 メールアカウント連携

1. 設定画面を開く（左メニューの「設定」）
2. 「メール連携」セクションを確認
3. 「Microsoft 365」の「連携する」ボタンをクリック

期待される動作：
- Microsoftログイン画面へリダイレクト
- ログイン後、権限承認画面が表示

### 4.2 権限の承認

Microsoft の承認画面で：
1. 要求される権限を確認：
   - ユーザープロファイルの読み取り
   - メールの読み取り
   - メールの読み書き
   - オフラインアクセス

2. 「承諾」をクリック

期待される動作：
- PMO Agentに自動的に戻る
- 「連携済み」と表示される

### 4.3 メール同期のテスト

#### テストメールの準備

Outlookで以下のメールを作成して自分宛に送信：

**メール1: 単純なタスク**
```
件名: [タスク] 週次レポートの作成
本文:
今週の週次レポートを作成してください。
期限: 今週金曜日
含める内容:
- 売上実績
- 課題と対策
- 来週の予定
```

**メール2: スレッドテスト（初回）**
```
件名: プロジェクトミーティングについて
本文:
来週のプロジェクトミーティングの日程を調整したいと思います。
候補日:
- 月曜日 14:00-15:00
- 火曜日 10:00-11:00
- 水曜日 15:00-16:00
```

**メール3: スレッドテスト（返信）**
```
件名: Re: プロジェクトミーティングについて
本文:
火曜日 10:00-11:00 で問題ありません。
会議室Aを予約しました。
アジェンダを事前に共有してください。
```

#### 同期の実行

1. ダッシュボードに戻る
2. 「メール同期」ボタンをクリック
3. 進行状況を確認

期待される動作：
- プログレスバーまたはスピナーが表示
- 「同期中...」のメッセージ
- 完了後、「3件のメールを処理しました」のような通知

### 4.4 同期結果の確認

#### タスクリストの確認

確認項目：
- [ ] 「週次レポートの作成」タスクが作成されている
- [ ] 「プロジェクトミーティングについて」タスクが1つだけ作成されている
- [ ] タスクに「AI作成」バッジが付いている

#### スレッド処理の確認

1. 「プロジェクトミーティングについて」タスクをクリック
2. 「メール履歴」タブを開く

確認項目：
- [ ] 2通のメールが時系列で表示される
- [ ] 初回メールと返信メールが区別される
- [ ] メール要約が表示される

## 5. AI機能の詳細テスト

### 5.1 タスク優先度の自動判定

テストメール：
```
件名: 【緊急】システム障害対応
本文:
本日14時頃から本番環境でエラーが発生しています。
至急対応をお願いします。
影響範囲: 全ユーザー
```

期待される結果：
- 優先度が「高」に自動設定
- ステータスが「TODO」
- AIが緊急性を認識

### 5.2 期限の自動抽出

テストメール：
```
件名: 月次報告書の提出について
本文:
2月15日（木）17時までに月次報告書を提出してください。
フォーマットは添付のテンプレートを使用してください。
```

期待される結果：
- 期限が「2024-02-15」に自動設定
- タスクタイトルが「月次報告書の提出」

### 5.3 複雑なスレッドの処理

連続した返信メールを作成：
1. 初回: タスク作成依頼
2. 返信1: 詳細質問
3. 返信2: 回答
4. 返信3: 承認

期待される結果：
- 1つのタスクとして管理
- ステータスが最新の内容に応じて更新
- メール履歴に全4通が表示

## 6. パフォーマンステスト

### 6.1 大量メールの同期

10通以上のメールがある状態で同期を実行

測定項目：
- 同期完了時間
- メモリ使用量
- API呼び出し回数

### 6.2 レスポンス時間の確認

```bash
# API レスポンス時間測定
time curl http://localhost:8000/api/v1/tasks

# 詳細なベンチマーク
ab -n 100 -c 10 http://localhost:8000/health
```

## 7. エラー処理の確認

### 7.1 OpenAI API エラー

`.env` で無効なAPIキーを設定してテスト：
```env
OPENAI_API_KEY=sk-invalid-key
```

期待される動作：
- エラーメッセージが適切に表示
- アプリケーションがクラッシュしない
- ログにエラーが記録される

### 7.2 Outlook認証エラー

トークンを無効化してメール同期を実行

期待される動作：
- 再認証を促すメッセージ
- 「再連携」ボタンが表示

## 8. セキュリティテスト

### 8.1 認証なしアクセス

```bash
# 認証なしでAPI呼び出し
curl http://localhost:8000/api/v1/tasks
```

期待される結果：
```json
{
  "detail": "Not authenticated"
}
```

### 8.2 他ユーザーのタスクアクセス

別のユーザーアカウントを作成して、他人のタスクIDでアクセス試行

期待される結果：
- 403 Forbidden エラー
- アクセス拒否メッセージ

## 9. ログの確認

### 9.1 アプリケーションログ

```bash
# バックエンドログ
tail -f packages/backend/pmo_agent.log

# 特定のエラーを検索
grep ERROR packages/backend/pmo_agent.log

# API呼び出しログ
grep "POST /api/v1" packages/backend/pmo_agent.log
```

### 9.2 デバッグ情報の確認

ブラウザの開発者ツール：
1. F12キーで開発者ツールを開く
2. Console タブでJSエラーを確認
3. Network タブでAPIリクエストを確認

## 10. テスト結果の記録

### テスト結果テンプレート

```markdown
# PMO Agent 動作確認結果

## テスト実施日時
2024-01-20 10:00

## 環境情報
- OS: Windows 11 / macOS 14 / Ubuntu 22.04
- Node.js: v18.17.0
- Python: 3.11.4
- ブラウザ: Chrome 120

## テスト結果サマリー

| カテゴリ | テスト項目数 | 成功 | 失敗 | スキップ |
|---------|------------|------|------|---------|
| 基本機能 | 10 | 10 | 0 | 0 |
| OpenAI連携 | 5 | 5 | 0 | 0 |
| Outlook連携 | 8 | 7 | 1 | 0 |
| セキュリティ | 3 | 3 | 0 | 0 |

## 詳細結果

### ✅ 成功したテスト
- ユーザー登録・ログイン
- タスクCRUD操作
- OpenAI API呼び出し
- メールスレッド処理

### ❌ 失敗したテスト
- Outlook大量メール同期（タイムアウト）
  - 原因: バッチサイズが大きすぎる
  - 対策: OUTLOOK_BATCH_SIZE=10 に変更

### ⚠️ 注意事項
- OpenAI API使用量: $0.15
- 処理時間が長いメール: 3秒以上

## 改善提案
1. キャッシュの有効活用
2. バッチサイズの最適化
3. エラーメッセージの改善
```

## 11. 次のステップ

テストが完了したら：

1. [トラブルシューティング](./05-troubleshooting.md) - 問題が発生した場合
2. [本番デプロイガイド](./06-deployment-guide.md) - 本番環境への展開
3. [運用ガイド](./07-operation-guide.md) - 日常運用とメンテナンス