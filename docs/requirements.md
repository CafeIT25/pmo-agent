# PMO Agent 要件定義書

## 1. システム概要

PMO Agent は、プロジェクトマネージャーの業務を AI で支援するシステムです。メールからタスクを自動抽出し、効率的なタスク管理と AI による課題解決支援を提供します。

### 1.1 主要機能

1. **メール連携によるタスク自動生成**
   - Google Workspace / Microsoft 365 連携
   - AI によるタスク判定と自動作成
   - 元メールへのリンク保持

2. **タスク管理ダッシュボード**
   - 直感的な UI でのタスク管理
   - ステータス・優先度管理
   - フィルタリング・検索機能

3. **AI タスクサポート**
   - タスクに基づく情報収集
   - 解決策の提案
   - 作業手順の生成

### 1.2 対象ユーザー

- 規模：1〜10 名のプロジェクトマネージャー
- 環境：PC ブラウザでの利用を想定
- スキル：一般的な Web アプリケーションを利用できるレベル

## 2. 機能要件（EARS 記法）

### 2.1 認証・アカウント管理

#### アカウント作成

```
WHEN ユーザーが新規登録画面でメールアドレスとパスワードを入力し、登録ボタンを押下した時
GIVEN 入力されたメールアドレスが有効な形式で、かつ未登録の場合
THEN システムは新規アカウントを作成する
AND パスワードを bcrypt（コスト係数 12）でハッシュ化して保存する
AND アカウント確認用のメールを送信する
AND 仮登録状態として記録する
```

```
WHEN ユーザーが確認メール内のリンクをクリックした時
GIVEN リンクのトークンが有効期限内（24 時間）の場合
THEN システムはアカウントを本登録状態に更新する
AND 登録完了画面を表示する
AND 自動的にログイン状態にする
```

#### ログイン・ログアウト

```
WHEN ユーザーがログイン画面でメールアドレスとパスワードを入力した時
GIVEN 認証情報が正しい場合
THEN システムは JWT トークンを発行する
AND アクセストークン（有効期限 1 時間）とリフレッシュトークン（有効期限 30 日）を返す
AND ダッシュボード画面にリダイレクトする
AND 最終ログイン日時を更新する
```

```
WHERE ログイン試行が
IS 5 回連続で失敗した場合
THE SYSTEM SHALL アカウントを 30 分間ロックする
AND ロック通知メールを送信する
AND 管理者に通知する
```

#### メール連携設定

```
WHEN ユーザーが設定画面で「Google アカウント連携」ボタンを押下した時
GIVEN ユーザーがログイン済みの場合
THEN システムは Google OAuth 2.0 の認証フローを開始する
AND 必要なスコープ（gmail.readonly）を要求する
AND 認証成功後、アクセストークンとリフレッシュトークンを取得する
AND トークンを AES-256 で暗号化して保存する
```

```
WHEN ユーザーが除外ドメイン設定で新しいドメインを追加した時
GIVEN ドメイン形式が有効な場合（例：example.com）
THEN システムは除外ドメインリストに追加する
AND 次回のメール同期から適用する
AND 設定変更の監査ログを記録する
```

### 2.2 メール連携・タスク自動生成

#### メール同期処理

```
WHEN ユーザーが「同期」ボタンを押下した時
GIVEN 有効なメール連携設定が存在する場合
THEN システムは非同期ジョブ（Celery タスク）を作成する
AND 同期状態を「処理中」に更新する
AND プログレスバーを表示する
```

```
WHILE メール同期ジョブが実行中の間
THE SYSTEM SHALL 過去 7 日間のメールを取得する
AND 除外ドメインリストに部分一致する送信者のメールを除外する
AND 既に処理済みのメール ID はスキップする
AND 100 件ごとにバッチ処理する
AND 進捗状況を更新する
```

#### タスク性判定

```
WHEN メール同期で新しいメールが取得された時
GIVEN メールの件名と本文が存在する場合
THEN システムは最大 50 件をまとめて AI API に送信する
AND 構造化されたプロンプトでタスク判定を要求する
AND JSON 形式でレスポンスを受け取る
AND 各メールのタスク性スコアを記録する
```

```
WHERE AI API の応答が
IS JSON パースエラーの場合
THE SYSTEM SHALL エラーログを記録する
AND 該当メールを「判定保留」として記録する
AND 処理を継続する
```

#### タスク自動作成

```
WHEN AI がメールをタスクと判定した時
GIVEN タスクタイトルと説明が生成された場合
THEN システムは新規タスクを作成する
AND デフォルトステータス「未着手」を設定する
AND 優先度を AI の判定に基づいて設定する
AND 元メールの ID と Web リンクを保存する
AND 作成通知を表示する
```

### 2.3 タスク管理ダッシュボード

#### タスク一覧表示

```
WHEN ユーザーがダッシュボードにアクセスした時
GIVEN ログイン状態の場合
THEN システムはユーザーのタスク一覧を取得する
AND デフォルトで未完了タスクを表示する
AND 優先度順にソートする
AND ページネーション（20 件/ページ）を適用する
```

```
WHILE ユーザーがタスク一覧を表示している間
THE SYSTEM SHALL WebSocket 接続を維持する
AND 他のデバイスでの変更をリアルタイム反映する
AND 楽観的更新を使用して UI の応答性を保つ
```

#### タスク操作

```
WHEN ユーザーがタスクカードをドラッグ&ドロップした時
GIVEN 移動先が有効なステータス列の場合
THEN システムはタスクのステータスを更新する
AND 楽観的更新で即座に UI を更新する
AND バックグラウンドで API を呼び出す
AND エラー時は元の位置に戻す
```

```
WHEN ユーザーがタスクタイトルをクリックした時
GIVEN タスクが編集可能な場合
THEN システムはインライン編集モードを有効にする
AND Enter キーで保存、Escape キーでキャンセルできる
AND 自動保存（3 秒後）を実行する
```

#### フィルタリング・検索

```
WHEN ユーザーがフィルター条件を設定した時
GIVEN 有効な条件（ステータス、優先度、期間）の場合
THEN システムは条件に合致するタスクのみを表示する
AND URL パラメータに条件を保存する
AND フィルター状態を視覚的に表示する
```

### 2.4 AI タスクサポート

#### AI サポート実行

```
WHEN ユーザーがタスク詳細画面で「AI でサポート」ボタンを押下した時
GIVEN タスクの内容が 10 文字以上の場合
THEN システムは AI サポートモーダルを表示する
AND タスク内容を AWS Bedrock API に送信する
AND ローディング状態を表示する
AND 生成中はボタンを無効化する
```

```
WHERE AI API の処理が
IS 30 秒以上かかっている場合
THE SYSTEM SHALL タイムアウト警告を表示する
AND キャンセルオプションを提供する
AND 部分的な結果があれば保存する
```

#### 調査・提案機能

```
WHEN AI がタスクの分析を完了した時
GIVEN 正常なレスポンスを受信した場合
THEN システムは結果を構造化して表示する
AND 「関連情報」「推奨アクション」「次のステップ」のセクションに分ける
AND 生成日時とモデル情報を記録する
AND 結果をタスクに紐付けて保存する
```

## 3. 非機能要件

### 3.1 パフォーマンス要件

```
WHERE システムの応答時間が測定される時
THE SYSTEM SHALL 以下の基準を満たす
- ログイン処理: 2 秒以内
- ダッシュボード初期表示: 3 秒以内（コールドスタート時を除く）
- タスク操作（作成/更新/削除）: 500ms 以内
- メール同期: 1000 件を 5 分以内に処理
- AI サポート生成: 30 秒以内
```

### 3.2 セキュリティ要件

```
WHERE セキュリティ脅威が存在する環境で
THE SYSTEM SHALL 以下の対策を実装する
- すべての通信を TLS 1.3 以上で暗号化
- パスワードを bcrypt（コスト係数 12）でハッシュ化
- JWT トークンに署名と有効期限を設定
- CSRF トークンによるリクエスト検証
- XSS 対策（Content Security Policy の適用）
- SQL インジェクション対策（パラメータ化クエリ）
- レート制限（同一 IP から 100 リクエスト/分まで）
```

### 3.3 可用性要件

```
WHERE システムの稼働が要求される時
THE SYSTEM SHALL 以下の可用性を提供する
- 月間稼働率: 95%以上（計画メンテナンスを除く）
- 自動ヘルスチェック（5 分間隔）
- エラー時の自動再起動
- データベースの日次バックアップ
```

### 3.4 スケーラビリティ要件

```
WHERE システムの負荷が増加した時
THE SYSTEM SHALL 以下の拡張性を持つ
- 同時接続ユーザー: 10 名まで
- データ保持: ユーザーあたり 10,000 タスクまで
- メール処理: 1 日あたり 5,000 件まで
- ストレージ: ユーザーあたり 1GB まで
```

## 4. 制約事項

### 4.1 技術的制約

- **インフラ**: 無料プランでの運用を前提
  - Vercel Hobby Plan (フロントエンド)
  - Render Free Plan (バックエンド、DB、Redis)
- **開発言語・フレームワーク**: 
  - フロントエンド: React + TypeScript
  - バックエンド: Python + FastAPI
- **外部サービス**:
  - AWS Bedrock (従量課金)
  - Google/Microsoft API (無料枠内)

### 4.2 運用制約

- **データ保持期間**: 
  - タスク: 無期限
  - メール元データ: 30 日間
  - ログ: 90 日間
- **バックアップ**: 日次（深夜 2 時）
- **メンテナンス**: 月 1 回（第 2 日曜日深夜）

## 5. 用語定義

| 用語 | 定義 |
|------|------|
| タスク | メールから抽出された、または手動で作成された作業項目 |
| ステータス | タスクの進行状態（未着手/進行中/完了） |
| 優先度 | タスクの重要度（高/中/低） |
| 同期 | メールサーバーから新着メールを取得し、タスクを生成する処理 |
| AI サポート | タスクに対する AI による調査・提案機能 |
| 除外ドメイン | タスク生成の対象から除外するメールドメイン |

## 6. 受け入れ基準

### 6.1 機能テスト

- [ ] 新規ユーザーがアカウントを作成し、メール確認を完了できる
- [ ] Google/Microsoft アカウントと連携できる
- [ ] メール同期でタスクが自動生成される
- [ ] タスクの CRUD 操作が正常に動作する
- [ ] AI サポートが適切な提案を生成する

### 6.2 非機能テスト

- [ ] 10 ユーザーが同時アクセスしても安定動作する
- [ ] 1000 件のメールを 5 分以内に処理できる
- [ ] セキュリティスキャンで重大な脆弱性が検出されない
- [ ] 主要ブラウザ（Chrome、Firefox、Safari、Edge）で正常動作する

### 6.3 ユーザビリティテスト

- [ ] 初回利用者が 10 分以内に基本操作を習得できる
- [ ] タスク操作のレスポンスが 500ms 以内
- [ ] エラー時に適切なメッセージが表示される
- [ ] モバイル表示でも基本機能が利用可能（将来対応）

## 7. リスクと対策

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| 無料プランの制限超過 | 高 | 中 | 使用量モニタリング、アラート設定 |
| AI API のコスト超過 | 高 | 中 | 月次上限設定、使用量追跡 |
| メール API の認証失効 | 中 | 低 | トークン自動更新、エラー通知 |
| データ漏洩 | 高 | 低 | 暗号化、アクセス制御、監査ログ |
| サービス停止 | 中 | 低 | 自動再起動、ヘルスチェック |

## 8. 将来の拡張性

### 8.1 検討中の機能

- チーム機能（タスクの共有・割り当て）
- カレンダー連携（期限管理）
- Slack/Teams 通知連携
- カスタムワークフロー
- レポート・分析機能

### 8.2 技術的拡張

- マイクロサービス化
- Kubernetes へのマイグレーション
- GraphQL API の導入
- リアルタイムコラボレーション
- オフライン対応（PWA）